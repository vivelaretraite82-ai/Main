<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vive la Retraite ‚Äî Sorties & Activit√©s pour Seniors</title>
<link rel="icon" href="logo.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="logo.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">

<style>
  :root {
    --sage: #7A9E7E;
    --sage-light: #B8D4BB;
    --sage-dark: #4A6E4E;
    --cream: #FAF7F2;
    --warm-white: #F5F0E8;
    --text: #2C2C2C;
    --text-light: #6B6B6B;
    --gold: #C9A96E;
    --gold-light: #E8D5B0;
    --border: #E0D8CC;
  }

  body[data-theme="dark"] {
    --cream: #101411;
    --warm-white: #141A16;
    --sage: #98C2A0;
    --sage-light: #45594B;
    --sage-dark: #B7E0BC;
    --gold: #D8C48A;
    --gold-light: #4B4330;
    --border: #283128;
    --text: #F3F3F1;
  }

  body[data-theme="dark"] .card-body,
  body[data-theme="dark"] .form-card,
  body[data-theme="dark"] .form-card p,
  body[data-theme="dark"] .form-label,
  body[data-theme="dark"] .form-input,
  body[data-theme="dark"] .form-textarea,
  body[data-theme="dark"] .form-row-bottom small,
  body[data-theme="dark"] .member-status,
  body[data-theme="dark"] .member-reservations,
  body[data-theme="dark"] .card-meta {
    color: var(--text);
  }
  body[data-theme="dark"] .card-title,
  body[data-theme="dark"] .card-desc,
  body[data-theme="dark"] .card-cat {
    color: var(--text);
  }

  body[data-theme="dark"] .card-title { font-weight: 600; }
  body[data-theme="dark"] .card-desc { font-weight: 600; }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  html { scroll-behavior: smooth; }

  body {
    font-family: 'Jost', sans-serif;
    font-weight: 300;
    background: var(--cream);
    color: var(--text);
    overflow-x: hidden;
    font-size: 18px;
  }

  /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.4rem 4rem;
    background: rgba(15,18,16,0.92);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    transition: padding .3s;
  }

  .nav-logo {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.6rem;
    font-weight: 400;
    color: #b9d7b9;
    letter-spacing: .04em;
  }

  .nav-logo span { color: var(--gold); font-style: italic; }

  .nav-links {
    display: flex;
    gap: 2.4rem;
    list-style: none;
  }

  .nav-badge {
    display: inline-block;
    margin-left: .35rem;
    padding: .05rem .36rem;
    border-radius: 999px;
    background: #e53935;
    color: #fff;
    font-size: .55rem;
    line-height: 1.1;
    vertical-align: middle;
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 1.2rem;
  }

  .theme-toggle {
    border-radius: 999px;
    border: 1px solid var(--border);
    background: rgba(0,0,0,0.02);
    padding: .25rem .85rem;
    display: flex;
    align-items: center;
    gap: .4rem;
    font-size: .78rem;
    letter-spacing: .08em;
    text-transform: uppercase;
    cursor: pointer;
    color: var(--text-light);
  }

  .nav-corner-logo {
    height: 36px;
    width: auto;
    border-radius: 4px;
    border: 1px solid var(--border);
    padding: 2px;
    background: #fff;
  }

  body[data-theme="dark"] .nav-corner-logo {
    background: transparent;
    border-color: var(--border);
    filter: brightness(0.95);
  }

  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.6);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    z-index: 2000;
  }
  .modal.open { display: flex; }
  .modal-panel {
    width: min(920px, 95vw);
    max-height: 90vh;
    overflow-y: auto;
    background: var(--warm-white);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 1.6rem;
    box-shadow: 0 30px 80px rgba(0,0,0,.35);
  }
  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }
  .modal-close {
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text);
    padding: .35rem .6rem;
    border-radius: 4px;
    cursor: pointer;
  }
  .call-number {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 700;
    letter-spacing: .03em;
    color: var(--text);
    text-align: center;
    margin: .4rem 0 1rem;
  }
  .call-actions {
    display: flex;
    gap: .8rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 1.2rem;
  }
  .btn-outline {
    border: 1px solid var(--sage-dark);
    background: transparent;
    color: var(--sage-dark);
    padding: .6rem 1rem;
    border-radius: 4px;
    cursor: pointer;
  }
  .call-note {
    text-align: center;
    color: var(--text);
    margin-bottom: 1rem;
  }
  .call-comments {
    display: grid;
    gap: .8rem;
  }
  .call-comment {
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: .8rem;
    background: var(--warm-white);
  }
  .call-comment .cc-meta {
    font-size: .85rem;
    color: var(--text-light);
    margin-bottom: .4rem;
  }

  .nav-menu-toggle {
    display: none;
    border: none;
    background: transparent;
    color: var(--text);
    font-size: 1.3rem;
    cursor: pointer;
    margin-right: 1rem;
  }

  .nav-drawer {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.45);
    display: none;
    z-index: 1800;
  }

  .nav-drawer.open {
    display: block;
  }

  .nav-drawer-panel {
    width: 260px;
    max-width: 80vw;
    height: 100%;
    background: var(--warm-white);
    box-shadow: 12px 0 40px rgba(0,0,0,.25);
    padding: 1.5rem 1.25rem;
    transform: translateX(-100%);
    transition: transform .25s ease-out;
  }

  .nav-drawer.open .nav-drawer-panel {
    transform: translateX(0);
  }

  .nav-drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }

  .nav-drawer-title {
    font-weight: 600;
    letter-spacing: .16em;
    text-transform: uppercase;
    font-size: .8rem;
    color: var(--text-light);
  }

  .nav-drawer-close {
    border: none;
    background: transparent;
    font-size: 1.1rem;
    cursor: pointer;
    color: var(--text-light);
  }

  .nav-drawer-links {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: .75rem;
  }

  .nav-drawer-links a {
    text-decoration: none;
    color: var(--text);
    font-size: .9rem;
    letter-spacing: .12em;
    text-transform: uppercase;
  }

  .nav-links a {
    text-decoration: none;
    color: #ffffff;
    font-size: .85rem;
    letter-spacing: .12em;
    text-transform: uppercase;
    transition: color .25s;
    position: relative;
  }

  .nav-links a::after {
    content: '';
    position: absolute;
    bottom: -3px; left: 0;
    width: 0; height: 1px;
    background: var(--gold);
    transition: width .3s;
  }

  .nav-links a:hover { color: var(--gold); }
  .nav-links a:hover::after { width: 100%; }

  .nav-cta {
    background: var(--sage);
    color: #fff !important;
    padding: .55rem 1.4rem;
    border-radius: 2px;
    transition: background .25s !important;
  }
  .nav-cta:hover { background: var(--sage-dark) !important; }
  .nav-cta::after { display: none !important; }

  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  .hero {
    min-height: 100vh;
    display: grid;
    grid-template-columns: 1fr 1fr;
    align-items: center;
    padding: 0 4rem;
    gap: 4rem;
    position: relative;
    overflow: hidden;
    background: #f7f3ea url('t%C3%A9l%C3%A9chargement%20(25)%20(1).jpg') center/cover no-repeat;
  }

  .hero::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, rgba(247,243,234,0.98) 0%, rgba(247,243,234,0.92) 40%, rgba(247,243,234,0.65) 70%, rgba(247,243,234,0.25) 100%);
    z-index: 0;
  }

  .hero-content { position: relative; z-index: 1; }

  .hero-tag {
    display: inline-flex;
    align-items: center;
    gap: .5rem;
    font-size: .72rem;
    letter-spacing: .18em;
    text-transform: uppercase;
    color: var(--sage-dark);
    margin-bottom: 1.8rem;
    opacity: 0;
    animation: fadeUp .8s .2s forwards;
  }

  .hero-tag::before {
    content: '';
    width: 28px; height: 1px;
    background: var(--gold);
  }

  .hero h1 {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2.8rem, 4.5vw, 4.2rem);
    font-weight: 300;
    line-height: 1.15;
    color: var(--text);
    margin-bottom: 1.6rem;
    opacity: 0;
    animation: fadeUp .9s .35s forwards;
  }

  .hero h1 em {
    font-style: italic;
    color: var(--sage-dark);
  }

  .hero-desc {
    font-size: 1.3rem;
    line-height: 1.9;
    color: #111111;
    font-weight: 600;
    max-width: 520px;
    margin-bottom: 2.8rem;
    opacity: 0;
    animation: fadeUp .9s .5s forwards;
  }

  .hero-actions {
    display: flex;
    gap: 1.2rem;
    align-items: center;
    opacity: 0;
    animation: fadeUp .9s .65s forwards;
  }

  .btn-primary {
    display: inline-block;
    background: var(--sage-dark);
    color: #fff;
    padding: .85rem 2.2rem;
    text-decoration: none;
    font-size: .82rem;
    letter-spacing: .14em;
    text-transform: uppercase;
    border-radius: 2px;
    transition: background .25s, transform .2s;
  }
  .btn-primary:hover { background: var(--sage); transform: translateY(-2px); }

  .btn-outline {
    display: inline-flex;
    align-items: center;
    gap: .6rem;
    color: var(--text-light);
    text-decoration: none;
    font-size: .82rem;
    letter-spacing: .1em;
    text-transform: uppercase;
    transition: color .25s;
  }
  .btn-outline .arrow {
    width: 32px; height: 1px;
    background: var(--gold);
    position: relative;
    transition: width .3s;
  }
  .btn-outline .arrow::after {
    content: '';
    position: absolute;
    right: -1px; top: -3px;
    width: 7px; height: 7px;
    border-right: 1px solid var(--gold);
    border-top: 1px solid var(--gold);
    transform: rotate(45deg);
  }
  .btn-outline:hover { color: var(--sage-dark); }
  .btn-outline:hover .arrow { width: 45px; }

  .hero-visual { display: none; }

  .hero-img-wrap {
    position: relative;
    width: 460px;
    height: 520px;
  }

  .hero-img-wrap .card-img {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--sage-light) 0%, var(--sage) 60%, var(--sage-dark) 100%);
    border-radius: 4px 80px 4px 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    box-shadow: 20px 30px 60px rgba(74,110,78,.2);
  }

  .hero-svg-scene {
    width: 80%;
    opacity: .9;
  }

  .hero-badge {
    position: absolute;
    bottom: -20px; left: -30px;
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 1rem 1.4rem;
    box-shadow: 0 10px 40px rgba(0,0,0,.08);
    display: flex;
    align-items: center;
    gap: .8rem;
  }

  .badge-icon {
    width: 40px; height: 40px;
    background: var(--gold-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
  }

  .badge-text strong {
    display: block;
    font-size: .95rem;
    font-weight: 500;
    color: var(--text);
  }

  .badge-text span {
    font-size: .75rem;
    color: var(--text-light);
    letter-spacing: .05em;
  }

  /* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
  .stats {
    display: flex;
    gap: 0;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    background: var(--warm-white);
    overflow: hidden;
  }

  .stat-item {
    flex: 1;
    padding: 2.5rem 3rem;
    text-align: center;
    border-right: 1px solid var(--border);
    transition: background .3s;
  }
  .stat-item:last-child { border-right: none; }
  .stat-item:hover { background: var(--cream); }

  .stat-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.8rem;
    font-weight: 300;
    color: var(--sage-dark);
    line-height: 1;
    margin-bottom: .3rem;
  }

  .stat-label {
    font-size: .75rem;
    letter-spacing: .12em;
    text-transform: uppercase;
    color: var(--text-light);
  }

  /* ‚îÄ‚îÄ SECTIONS COMMUNES ‚îÄ‚îÄ */
  section { padding: 7rem 4rem; }

  .section-tag {
    font-size: .72rem;
    letter-spacing: .2em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: .6rem;
  }

  .section-tag::after {
    content: '';
    flex: 1;
    max-width: 40px;
    height: 1px;
    background: var(--gold-light);
  }

  .section-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 3vw, 2.8rem);
    font-weight: 300;
    line-height: 1.25;
    color: var(--text);
    margin-bottom: 1rem;
  }

  .section-title em { font-style: italic; color: var(--sage-dark); }

  .section-sub {
    font-size: .95rem;
    line-height: 1.8;
    color: var(--text-light);
    max-width: 500px;
  }

  .member-grid {
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 2rem;
    align-items: flex-start;
  }

  .member-status {
    margin-top: 1rem;
    font-size: .85rem;
    color: var(--text-light);
  }

  .member-reservations {
    margin-top: 1.2rem;
    font-size: .85rem;
  }

  .member-reservations h4 {
    font-size: .9rem;
    margin-bottom: .6rem;
  }

  .reservation-item {
    border-top: 1px solid var(--border);
    padding: .6rem 0;
  }

  .reservation-item-cancelled .reservation-item-title {
    text-decoration: line-through;
    color: var(--text-light);
  }

  .reservation-item-cancelled .reservation-item-meta {
    color: var(--text-light);
  }

  .reservation-item-title {
    font-weight: 500;
    font-size: .86rem;
  }

  .reservation-item-meta {
    font-size: .78rem;
    color: var(--text-light);
  }

  /* ‚îÄ‚îÄ ACTIVIT√âS ‚îÄ‚îÄ */
  #activites { background: var(--cream); }

  .activities-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 4rem;
    gap: 2rem;
  }

  .activities-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .activity-card {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    transition: transform .3s, box-shadow .3s;
    cursor: pointer;
  }

  .activity-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 20px 50px rgba(0,0,0,.08);
  }

  .activity-card:first-child {
    grid-row: span 2;
  }

  .card-thumb {
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    position: relative;
    overflow: hidden;
  }

  .card-thumb .thumb-bg {
    position: absolute;
    inset: 0;
    opacity: .15;
    background: currentColor;
  }

  .activity-card:first-child .card-thumb {
    height: 280px;
  }

  .card-body {
    padding: 1.6rem;
  }

  .card-cat {
    font-size: .68rem;
    letter-spacing: .15em;
    text-transform: uppercase;
    color: var(--sage);
    margin-bottom: .5rem;
  }

  .card-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.45rem;
    font-weight: 500;
    color: var(--text);
    margin-bottom: .5rem;
    line-height: 1.3;
  }

  .card-desc {
    font-size: 1rem;
    color: var(--text);
    font-weight: 500;
    line-height: 1.7;
    margin-bottom: 1.2rem;
  }

  .card-meta {
    display: flex;
    gap: 1rem;
    font-size: 1rem;
    color: #111111;
    font-weight: 600;
    padding-top: 1rem;
    border-top: 1px solid var(--border);
  }
  .card-meta span {
    display: flex;
    align-items: center;
    gap: .35rem;
    color: #111111;
  }

  .card-meta span { display: flex; align-items: center; gap: .3rem; }

  /* ‚îÄ‚îÄ COMMENT √áA MARCHE ‚îÄ‚îÄ */
  #comment { background: var(--warm-white); }

  .steps-wrap {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6rem;
    align-items: center;
  }

  .steps-list { margin-top: 3rem; }

  .step {
    display: flex;
    gap: 1.5rem;
    padding: 1.8rem 0;
    border-bottom: 1px solid var(--border);
    transition: background .2s;
  }
  .step:first-child { padding-top: 0; }
  .step:last-child { border-bottom: none; }

  .step-num {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.2rem;
    font-weight: 300;
    color: var(--border);
    min-width: 3rem;
    line-height: 1;
    padding-top: .2rem;
    transition: color .3s;
  }

  .step:hover .step-num { color: var(--gold); }

  .step-content h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.2rem;
    font-weight: 400;
    color: var(--text);
    margin-bottom: .4rem;
  }

  .step-content p {
    font-size: .88rem;
    color: var(--text-light);
    line-height: 1.7;
  }

  .steps-visual {
    position: relative;
    height: 480px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .visual-circle {
    width: 360px;
    height: 360px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--sage-light) 0%, var(--sage) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 5rem;
    box-shadow: 0 20px 60px rgba(122,158,126,.3);
    position: relative;
    overflow: hidden;
  }

  .visual-circle::before {
    content: '';
    position: absolute;
    top: -30%; left: -30%;
    width: 60%; height: 60%;
    background: rgba(255,255,255,.2);
    border-radius: 50%;
  }

  .floating-card {
    position: absolute;
    background: #fff;
    border: 1px solid var(--border);
    padding: 1rem 1.2rem;
    border-radius: 4px;
    box-shadow: 0 8px 30px rgba(0,0,0,.07);
    font-size: .8rem;
    white-space: nowrap;
  }

  .floating-card.fc1 { top: 20px; right: -20px; }
  .floating-card.fc2 { bottom: 40px; left: -30px; }

  .fc-dot {
    display: inline-block;
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--sage);
    margin-right: .4rem;
  }

  /* ‚îÄ‚îÄ TEMOIGNAGES ‚îÄ‚îÄ */
  #temoignages { background: var(--cream); }

  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-top: 4rem;
  }

  .testimonial-card {
    background: #fff;
    border: 1px solid var(--border);
    padding: 2.2rem;
    border-radius: 4px;
    position: relative;
    transition: box-shadow .3s;
  }

  .testimonial-card:hover {
    box-shadow: 0 12px 40px rgba(0,0,0,.07);
  }

  .testimonial-card::before {
    content: '"';
    font-family: 'Cormorant Garamond', serif;
    font-size: 5rem;
    color: var(--sage-light);
    line-height: 1;
    position: absolute;
    top: 1rem; right: 1.5rem;
    opacity: .6;
  }

  .testimonial-text {
    font-size: .9rem;
    line-height: 1.8;
    color: var(--text-light);
    margin-bottom: 1.5rem;
    font-style: italic;
  }

  .testimonial-author {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .author-avatar {
    width: 44px; height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    background: var(--warm-white);
    border: 1px solid var(--border);
  }

  .author-name {
    font-size: .88rem;
    font-weight: 500;
    color: var(--text);
  }

  .author-info {
    font-size: .75rem;
    color: var(--text-light);
  }

  .stars {
    color: var(--gold);
    font-size: .75rem;
    margin-bottom: .3rem;
  }

  /* ‚îÄ‚îÄ FAQ ‚îÄ‚îÄ */
  #faq { background: var(--warm-white); }

  .faq-layout {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 6rem;
    align-items: start;
    margin-top: 3rem;
  }

  .faq-intro p {
    font-size: .9rem;
    color: var(--text-light);
    line-height: 1.8;
    margin-top: 1.2rem;
    margin-bottom: 2rem;
  }

  .faq-contact {
    display: inline-flex;
    align-items: center;
    gap: .7rem;
    font-size: .82rem;
    letter-spacing: .08em;
    text-transform: uppercase;
    color: var(--sage-dark);
    text-decoration: none;
    border: 1px solid var(--sage-dark);
    padding: .7rem 1.4rem;
    border-radius: 2px;
    transition: background .25s, color .25s;
  }

  .faq-contact:hover {
    background: var(--sage-dark);
    color: #fff;
  }

  .faq-list { display: flex; flex-direction: column; gap: 0; }

  .faq-item {
    border-bottom: 1px solid var(--border);
    overflow: hidden;
  }

  .faq-item:first-child {
    border-top: 1px solid var(--border);
  }

  .faq-question {
    width: 100%;
    background: none;
    border: none;
    padding: 1.5rem 0;
    text-align: left;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    font-weight: 400;
    color: var(--text);
    transition: color .25s;
  }

  .faq-question:hover { color: var(--sage-dark); }

  .faq-icon {
    width: 24px; height: 24px;
    border: 1px solid var(--border);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    color: var(--text-light);
    font-size: .9rem;
    transition: background .25s, color .25s, transform .3s;
  }

  .faq-item.open .faq-icon {
    background: var(--sage-dark);
    color: #fff;
    border-color: var(--sage-dark);
    transform: rotate(45deg);
  }

  .faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height .4s cubic-bezier(.4,0,.2,1);
  }

  .faq-item.open .faq-answer { max-height: 300px; }

  .faq-answer-inner {
    padding-bottom: 1.5rem;
    font-size: .9rem;
    color: var(--text-light);
    line-height: 1.8;
  }

  /* ‚îÄ‚îÄ CTA ‚îÄ‚îÄ */
  .cta-section {
    background: var(--sage-dark);
    padding: 7rem 4rem;
    position: relative;
    overflow: hidden;
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 4rem;
    align-items: start;
  }

  .cta-section::before {
    content: '';
    position: absolute;
    top: -50%; left: -20%;
    width: 60vw; height: 200%;
    background: radial-gradient(ellipse, rgba(201,169,110,.15) 0%, transparent 70%);
    pointer-events: none;
  }

  .cta-section .section-tag { justify-content: flex-start; color: var(--sage-light); }
  .cta-section .section-tag::after { background: var(--sage); }

  .cta-section .section-title {
    color: #fff;
    font-size: clamp(2.2rem, 3.5vw, 3rem);
    margin-bottom: 1.2rem;
  }

  .cta-section .section-title em { color: var(--gold-light); }

  .cta-section p {
    font-size: .95rem;
    color: rgba(255,255,255,.65);
    max-width: 480px;
    margin-bottom: 2.2rem;
    line-height: 1.8;
  }

  .cta-highlights {
    display: flex;
    flex-direction: column;
    gap: .6rem;
    font-size: .88rem;
    color: rgba(255,255,255,.75);
  }

  .cta-highlights span {
    display: inline-flex;
    align-items: center;
    gap: .4rem;
  }

  .cta-highlights span strong {
    font-weight: 500;
    color: #fff;
  }

  .cta-section .btn-primary {
    background: var(--gold);
    color: #fff;
    font-size: .88rem;
    padding: 1rem 2.6rem;
  }
  .cta-section .btn-primary:hover { background: var(--gold-light); color: var(--text); }

  .feedback-banner {
    position: fixed;
    top: 76px;
    left: 50%;
    transform: translateX(-50%);
    background: #fff;
    color: var(--sage-dark);
    padding: .8rem 1.4rem;
    border-radius: 999px;
    box-shadow: 0 10px 30px rgba(0,0,0,.14);
    font-size: .85rem;
    z-index: 90;
    display: none;
    white-space: nowrap;
  }

  .feedback-banner.visible {
    display: inline-flex;
    align-items: center;
    gap: .6rem;
  }

  .form-card {
    background: #fff;
    border-radius: 4px;
    border: 1px solid var(--border);
    padding: 2rem;
    box-shadow: 0 14px 40px rgba(0,0,0,.18);
  }

  .form-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 400;
    color: var(--text);
    margin-bottom: .4rem;
  }

  .form-card p {
    font-size: .86rem;
    color: var(--text-light);
    margin-bottom: 1.6rem;
  }

  .form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem 1.4rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: .35rem;
    font-size: .85rem;
  }

  .form-group.full {
    grid-column: 1 / -1;
  }

  .form-label {
    color: var(--text);
    font-weight: 400;
  }

  .form-label span {
    color: var(--gold);
  }

  .form-input,
  .form-select,
  .form-textarea {
    border-radius: 3px;
    border: 1px solid var(--border);
    padding: .65rem .8rem;
    font-family: inherit;
    font-size: .86rem;
    outline: none;
    transition: border-color .2s, box-shadow .2s;
  }

  .form-textarea {
    resize: vertical;
    min-height: 90px;
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    border-color: var(--sage-dark);
    box-shadow: 0 0 0 1px rgba(122,158,126,.25);
  }

  .form-note {
    font-size: .75rem;
    color: var(--text-light);
    margin-top: .6rem;
  }

  .form-row-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    margin-top: 1.4rem;
  }

  .form-row-bottom .btn-primary {
    border: none;
    cursor: pointer;
  }

  .form-row-bottom small {
    font-size: .75rem;
    color: var(--text-light);
  }

  .admin-layout {
    display: grid;
    grid-template-columns: 2fr 2fr;
    gap: 2.5rem;
    align-items: flex-start;
  }
  .admin-box {
    background: var(--card-bg);
    border-radius: 18px;
    padding: 1.8rem 2rem;
    box-shadow: 0 18px 45px rgba(25,48,35,0.18);
  }
  .admin-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    font-size: .86rem;
  }
  .admin-table th,
  .admin-table td {
    padding: .5rem .6rem;
    border-bottom: 1px solid var(--border);
    text-align: left;
  }
  .admin-table th {
    font-size: .78rem;
    text-transform: uppercase;
    letter-spacing: .08em;
    color: var(--text-light);
  }
  .admin-sortie-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: .8rem 0;
    border-bottom: 1px solid var(--border);
    font-size: .9rem;
  }
  .admin-sortie-main {
    display: flex;
    flex-direction: column;
  }
  .admin-sortie-meta {
    font-size: .78rem;
    color: var(--text-light);
  }
  .admin-sortie-actions {
    display: flex;
    gap: .6rem;
    align-items: center;
  }
  .admin-delete-btn {
    border: 1px solid #B3261E;
    color: #B3261E;
    background: transparent;
    padding: .4rem .7rem;
    border-radius: 999px;
    font-size: .78rem;
    cursor: pointer;
  }
  .admin-delete-btn:hover {
    background: rgba(179,38,30,0.1);
  }

  .messages-list {
    max-height: 260px;
    overflow-y: auto;
    padding-right: .5rem;
    margin-bottom: 1rem;
  }
  .message-item {
    margin-bottom: .6rem;
    display: flex;
  }
  .message-item.me {
    justify-content: flex-end;
  }
  .message-bubble {
    max-width: 80%;
    padding: .45rem .7rem;
    border-radius: 14px;
    font-size: .86rem;
    line-height: 1.4;
  }
  .message-item.me .message-bubble {
    background: var(--gold);
    color: #111;
  }
  .message-item.them .message-bubble {
    background: rgba(255,255,255,0.08);
    color: var(--text);
  }
  .message-meta {
    font-size: .72rem;
    color: var(--text-light);
    margin-top: .15rem;
  }

  .admin-messages-layout {
    display: grid;
    grid-template-columns: 1.1fr 2fr;
    gap: 1.5rem;
  }
  .admin-threads {
    border-right: 1px solid var(--border);
    max-height: 320px;
    overflow-y: auto;
    padding-right: .75rem;
  }
  .admin-thread {
    padding: .45rem .3rem;
    border-radius: 10px;
    cursor: pointer;
    margin-bottom: .3rem;
  }
  .admin-thread.active {
    background: rgba(255,255,255,0.06);
  }
  .admin-thread-title {
    font-size: .86rem;
  }
  .admin-thread-meta {
    font-size: .72rem;
    color: var(--text-light);
  }
  .admin-messages-list {
    max-height: 260px;
    overflow-y: auto;
    margin-bottom: .6rem;
  }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  footer {
    background: #1E2820;
    color: rgba(255,255,255,.5);
    padding: 4rem;
    display: grid;
    grid-template-columns: 2fr 1fr 1fr;
    gap: 3rem;
  }

  .footer-brand .nav-logo {
    color: rgba(255,255,255,.9);
    display: block;
    margin-bottom: 1rem;
    font-size: 1.4rem;
  }
  .footer-logo-img {
    height: 64px;
    width: auto;
    border-radius: 4px;
    border: 1px solid rgba(255,255,255,.15);
    display: inline-block;
    margin: .3rem 0 1rem;
  }

  .footer-brand p {
    font-size: .82rem;
    line-height: 1.8;
    max-width: 240px;
  }

  .footer-col h4 {
    font-size: .72rem;
    letter-spacing: .15em;
    text-transform: uppercase;
    color: rgba(255,255,255,.8);
    margin-bottom: 1.2rem;
  }

  .footer-col ul { list-style: none; }
  .footer-col ul li { margin-bottom: .6rem; }
  .footer-col ul a {
    text-decoration: none;
    color: rgba(255,255,255,.45);
    font-size: .83rem;
    transition: color .25s;
  }
  .footer-col ul a:hover { color: var(--sage-light); }

  .footer-bottom {
    background: #161D18;
    padding: 1.2rem 4rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: .75rem;
    color: rgba(255,255,255,.3);
  }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
  }

  .reveal {
    opacity: 0;
    transform: translateY(24px);
    transition: opacity .7s, transform .7s;
  }

  .reveal.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media (max-width: 1024px) {
    nav { padding: 1.2rem 1.2rem; }
    .nav-menu-toggle { display: inline-flex; align-items: center; justify-content: center; }
    .nav-logo { font-size: .95rem; }
    .nav-right { margin-left: auto; gap: .4rem; }
    .hero { padding: 8rem 2rem 4rem; grid-template-columns: 1fr; text-align: center; }
    .hero::before { display: none; }
    .hero-visual { display: none; }
    .hero-actions { justify-content: center; }
    section { padding: 5rem 2rem; }
    .activities-header { flex-direction: column; align-items: flex-start; }
    .activities-grid { grid-template-columns: 1fr 1fr; }
    .activity-card:first-child { grid-row: span 1; }
    .steps-wrap, .faq-layout { grid-template-columns: 1fr; gap: 3rem; }
    .steps-visual { display: none; }
    .testimonials-grid { grid-template-columns: 1fr; }
    .cta-section {
      grid-template-columns: 1fr;
      padding: 5rem 2rem;
    }
    footer { grid-template-columns: 1fr 1fr; }
    footer { grid-template-columns: 1fr 1fr; }
    .nav-links { display: none; }
  }

  @media (max-width: 640px) {
    nav { padding: .9rem 1rem; }
    .hero {
      padding: 5rem 1.4rem 3rem;
      grid-template-columns: 1fr;
      text-align: left;
    }
    .hero h1 {
      font-size: 2.4rem;
      line-height: 1.2;
    }
    .hero-desc {
      font-size: 1.05rem;
      max-width: none;
    }
    section {
      padding: 4rem 1.4rem;
    }
  }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <button type="button" id="nav-menu-toggle" class="nav-menu-toggle" aria-label="Ouvrir le menu">‚ò∞</button>
  <a href="#accueil" class="nav-logo">Vive la Retraite</a>
  <div class="nav-right">
    <ul class="nav-links">
      <li><a href="#activites">Activit√©s</a></li>
      <li><a href="sorties.html">Sorties</a></li>
      <li><a href="#comment">Comment √ßa marche</a></li>
      <li><a href="#temoignages">T√©moignages</a></li>
      <li><a href="#faq">FAQ</a></li>
      <li><a href="#espace-membre">Espace membre</a></li>
      <li><a href="messages.html" id="nav-messages-link" target="_blank">Messagerie<span id="nav-messages-badge" class="nav-badge" style="display:none;">‚óè</span></a></li>
      <li><a href="#contact" class="nav-cta">Contact</a></li>
      <li id="nav-admin-item" style="display:none;"><a href="#admin-panel">Admin</a></li>
    </ul>
    <button type="button" id="nav-login" class="nav-cta" style="background:transparent;color:var(--text);border:1px solid var(--border);">Connexion</button>
    <button type="button" id="nav-logout" class="nav-cta" style="display:none;background:transparent;color:var(--text);border:1px solid var(--border);">D√©connexion</button>
    <button type="button" id="open-inscription" class="nav-cta" style="background:var(--gold);color:#111;">Inscription</button>
    <button type="button" class="theme-toggle" aria-label="Changer de th√®me">
      <span class="theme-toggle-icon">üåô</span>
      <span class="theme-toggle-label">Sombre</span>
    </button>
  </div>
</nav>

<div id="nav-drawer" class="nav-drawer" aria-hidden="true">
  <div class="nav-drawer-panel">
    <div class="nav-drawer-header">
      <div class="nav-drawer-title">Menu</div>
      <button type="button" id="nav-drawer-close" class="nav-drawer-close" aria-label="Fermer le menu">‚úï</button>
    </div>
    <ul class="nav-drawer-links">
      <li><a href="#activites">Activit√©s</a></li>
      <li><a href="sorties.html">Sorties</a></li>
      <li><a href="#comment">Comment √ßa marche</a></li>
      <li><a href="#temoignages">T√©moignages</a></li>
      <li><a href="#faq">FAQ</a></li>
      <li><a href="#espace-membre">Espace membre</a></li>
      <li><a href="messages.html" id="nav-messages-link-mobile" target="_blank">Messagerie<span id="nav-messages-badge-mobile" class="nav-badge" style="display:none;">‚óè</span></a></li>
      <li><a href="#contact">Contact</a></li>
      <li id="nav-admin-item-mobile" style="display:none;"><a href="#admin-panel">Admin</a></li>
    </ul>
  </div>
</div>

<div id="feedback-banner" class="feedback-banner"></div>

<!-- HERO -->
<section class="hero" id="accueil">
  <div class="hero-content">
    <div class="hero-tag">Vive la Retraite avec Alexandra</div>
    <h1>Chaque journ√©e<br>m√©rite d‚Äô√™tre<br><em>une aventure</em></h1>
    <p class="hero-desc">Alexandra accompagne les seniors dans la d√©couverte d‚Äôactivit√©s culturelles et sociales, pens√©es pour leur confort et leur √©panouissement.</p>
    <div class="hero-actions">
      <a href="#activites" class="btn-primary">D√©couvrir les sorties</a>
      <a href="#comment" class="btn-outline"><span class="arrow"></span>Comment √ßa marche</a>
    </div>
  </div>
  <div class="hero-visual">
    <div class="hero-img-wrap">
      <div class="card-img">
        <svg class="hero-svg-scene" viewBox="0 0 300 280" fill="none" xmlns="http://www.w3.org/2000/svg">
          <!-- People silhouettes walking in nature -->
          <circle cx="150" cy="60" r="50" fill="rgba(255,255,255,.12)"/>
          <ellipse cx="150" cy="200" rx="100" ry="20" fill="rgba(255,255,255,.08)"/>
          <!-- Person 1 -->
          <circle cx="120" cy="130" r="16" fill="rgba(255,255,255,.7)"/>
          <rect x="112" y="148" width="16" height="40" rx="8" fill="rgba(255,255,255,.7)"/>
          <!-- Person 2 -->
          <circle cx="160" cy="125" r="14" fill="rgba(255,255,255,.5)"/>
          <rect x="153" y="141" width="14" height="36" rx="7" fill="rgba(255,255,255,.5)"/>
          <!-- Tree left -->
          <rect x="60" y="170" width="8" height="40" rx="4" fill="rgba(255,255,255,.3)"/>
          <ellipse cx="64" cy="155" rx="20" ry="28" fill="rgba(255,255,255,.2)"/>
          <!-- Tree right -->
          <rect x="220" y="175" width="8" height="35" rx="4" fill="rgba(255,255,255,.3)"/>
          <ellipse cx="224" cy="162" rx="16" ry="22" fill="rgba(255,255,255,.2)"/>
          <!-- Sun -->
          <circle cx="230" cy="55" r="22" fill="rgba(255,255,255,.25)"/>
          <circle cx="230" cy="55" r="14" fill="rgba(255,255,255,.35)"/>
          <!-- Path -->
          <path d="M 80 220 Q 150 200 220 220" stroke="rgba(255,255,255,.25)" stroke-width="3" fill="none"/>
          <!-- Stars/flowers -->
          <circle cx="90" cy="90" r="3" fill="rgba(255,255,255,.4)"/>
          <circle cx="200" cy="100" r="2" fill="rgba(255,255,255,.3)"/>
          <circle cx="175" cy="75" r="4" fill="rgba(255,255,255,.35)"/>
        </svg>
      </div>
      <div class="hero-badge">
        <div class="badge-icon">üåü</div>
        <div class="badge-text">
          <strong>+21 membres</strong>
          <span>actifs cette ann√©e</span>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="messagerie">
  <div class="section-tag">Messagerie</div>
  <h2 class="section-title">√âchanger avec <em>Alexandra</em></h2>
  <div class="form-card messaging-card">
    <div id="messaging-guest" class="section-sub">Connectez-vous √† votre espace membre pour envoyer et lire vos messages.</div>
    <div id="messaging-thread" style="display:none;">
      <div id="messages-list" class="messages-list"></div>
      <form id="message-form">
        <div class="form-group full">
          <label class="form-label" for="message-text"><span>*</span> Votre message</label>
          <textarea class="form-textarea" id="message-text" name="body" required placeholder="√âcrivez √† Alexandra comme si vous envoyiez un SMS‚Ä¶"></textarea>
        </div>
        <div class="form-row-bottom">
          <small>Alexandra vous r√©pondra directement depuis son espace administrateur.</small>
          <button type="submit" class="btn-primary">Envoyer le message</button>
        </div>
      </form>
    </div>
  </div>
</section>

<section id="admin-panel" style="display:none;">
  <div class="section-tag">Espace administrateur</div>
  <h2 class="section-title">Gestion des r√©servations et des sorties</h2>
  <div class="admin-layout">
    <div class="admin-box">
      <h3>R√©servations r√©centes</h3>
      <div id="admin-reservations-empty" class="section-sub">Aucune r√©servation trouv√©e pour le moment.</div>
      <table class="admin-table" id="admin-reservations-table" style="display:none;">
        <thead>
          <tr>
            <th>Date</th>
            <th>Membre</th>
            <th>Sortie</th>
            <th>Contact</th>
          </tr>
        </thead>
        <tbody id="admin-reservations-body"></tbody>
      </table>
    </div>
    <div class="admin-box">
      <h3>Sorties √† l‚Äôaffiche</h3>
      <div id="admin-sorties-list"></div>
      <h4>Cr√©er une nouvelle sortie</h4>
      <form id="admin-sortie-form">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="admin-sortie-categorie"><span>*</span> Cat√©gorie</label>
            <select class="form-input" id="admin-sortie-categorie" name="categorie" required>
              <option value="">‚Äî Choisir une cat√©gorie ‚Äî</option>
              <option value="Cin√©ma">üé¨ Cin√©ma</option>
              <option value="Mus√©e">üñºÔ∏è Mus√©e</option>
              <option value="Th√©√¢tre">üé≠ Th√©√¢tre</option>
              <option value="Zoo">üêæ Zoo</option>
              <option value="Balade douce">üö∂‚Äç‚ôÄÔ∏è Balade</option>
              <option value="March√© gourmand">üß∫ March√© gourmand</option>
              <option value="Atelier cr√©atif">üé® Atelier cr√©atif</option>
              <option value="Repas convivial">üç≤ Repas convivial</option>
              <option value="Concert/Chorale">üé∂ Concert/Chorale</option>
              <option value="Guinguette/Danse">üíÉ Guinguette/Danse</option>
              <option value="Laser game">üéØ Laser game</option>
              <option value="Jardin botanique">üåø Jardin botanique</option>
              <option value="Sortie insolite">üß≠ Sortie insolite</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="admin-sortie-titre"><span>*</span> Titre</label>
            <input class="form-input" type="text" id="admin-sortie-titre" name="titre" required placeholder='Ex: Soir√©e "Les Choristes" au cin√©ma'>
            <small class="form-help">Nom visible sur la carte de la sortie.</small>
          </div>
          <div class="form-group">
            <label class="form-label" for="admin-sortie-date">Date</label>
            <input class="form-input" type="date" id="admin-sortie-date" name="date_iso" placeholder="jj/mm/aaaa">
            <small class="form-help">Optionnel. Laissez vide si la date est √† confirmer.</small>
          </div>
          <div class="form-group">
            <label class="form-label" for="admin-sortie-lieu">Lieu</label>
            <input class="form-input" type="text" id="admin-sortie-lieu" name="lieu" placeholder="Ex: Caf√© des Arts ‚Äî Montauban">
            <small class="form-help">Ex: Th√©√¢tre Olympe de Gouges ‚Äî Montauban</small>
          </div>
          <div class="form-group full">
            <label class="form-label" for="admin-sortie-description">Description</label>
            <textarea class="form-textarea" id="admin-sortie-description" name="description" placeholder="Ex: S√©ance adapt√©e (fauteuils confort, acc√®s facile), boisson chaude offerte apr√®s la s√©ance."></textarea>
            <small class="form-help">Ajoutez les infos utiles: accessibilit√©, rythme, petites attentions, etc.</small>
          </div>
          <div class="form-group full">
            <label class="form-label" for="admin-sortie-image">Image (optionnelle)</label>
            <input class="form-input" type="file" id="admin-sortie-image" name="image" accept="image/*">
            <small class="form-help" id="admin-image-help">Formats accept√©s: JPG, PNG, WEBP ‚Ä¢ Max 5 Mo.</small>
          </div>
        </div>
        <div class="form-row-bottom">
          <small>Les sorties cr√©√©es ici apparaissent dans la section Sorties du site.</small>
          <button type="submit" class="btn-primary">Cr√©er la sortie</button>
        </div>
      </form>
      <div id="admin-sorties-note" class="member-status"></div>
    </div>
    <div class="admin-box">
      <h3>Messagerie membres</h3>
      <div class="admin-messages-layout">
        <div class="admin-threads" id="admin-threads"></div>
        <div>
          <div class="section-sub" id="admin-thread-header">S√©lectionnez un membre pour voir la conversation.</div>
          <div id="admin-messages-list" class="admin-messages-list"></div>
          <form id="admin-message-form">
            <div class="form-group full">
              <label class="form-label" for="admin-message-text"><span>*</span> R√©ponse √† envoyer</label>
              <textarea class="form-textarea" id="admin-message-text" name="body" required></textarea>
            </div>
            <div class="form-row-bottom">
              <small>Vos r√©ponses sont visibles dans la messagerie du membre.</small>
              <button type="submit" class="btn-primary">Envoyer</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- STATS -->
<div class="stats">
  <div class="stat-item reveal">
    <div class="stat-num">+10</div>
    <div class="stat-label">Types d'activit√©s</div>
  </div>
  <div class="stat-item reveal">
    <div class="stat-num">98%</div>
    <div class="stat-label">Satisfaction</div>
  </div>
</div>

<!-- ACTIVIT√âS -->
<section id="activites">
  <div class="activities-header reveal">
    <div>
      <div class="section-tag">Notre programme</div>
      <h2 class="section-title">Des activit√©s pens√©es<br>pour <em>votre bien-√™tre</em></h2>
    </div>
    <p class="section-sub">Chaque sortie est soigneusement s√©lectionn√©e et encadr√©e par notre √©quipe bienveillante, avec un accompagnement personnalis√© tout au long de la journ√©e.</p>
  </div>

  <div class="activities-grid">
    <div class="activity-card reveal">
      <div class="card-thumb" style="background: linear-gradient(135deg,#B8D4BB,#7A9E7E);">
        <div class="thumb-bg"></div>
        <span style="position:relative;z-index:1;font-size:3.5rem">üåø</span>
      </div>
      <div class="card-body">
        <div class="card-cat">Plein air</div>
        <h3 class="card-title">Promenades & randonn√©es douces en nature</h3>
        <p class="card-desc">Des balades adapt√©es √† votre rythme, dans des cadres naturels exceptionnels. For√™ts, parcs, bords de rivi√®re ‚Äî chaque sortie est une bouff√©e d'air pur.</p>
        <div class="card-meta">
          <span>üìÖ Hebdomadaire</span>
          <span>üë• 3 √† 7 pers.</span>
          <span>üöå Transport inclus</span>
        </div>
      </div>
    </div>

    <div class="activity-card reveal">
      <div class="card-thumb" style="background: linear-gradient(135deg,#E8D5B0,#C9A96E);">
        <div class="thumb-bg"></div>
        <span style="position:relative;z-index:1">üé≠</span>
      </div>
      <div class="card-body">
        <div class="card-cat">Culture</div>
        <h3 class="card-title">Th√©√¢tre, op√©ra & expositions</h3>
        <p class="card-desc">Acc√®s privil√©gi√© aux meilleures salles et mus√©es de la r√©gion, avec accompagnement et places r√©serv√©es.</p>
        <div class="card-meta">
          <span>üìÖ 2√ó / mois</span>
          <span>üë• 4 √† 7 pers.</span>
        </div>
      </div>
    </div>
    
    <div class="activity-card reveal">
      <div class="card-thumb" style="background: linear-gradient(135deg,#F0E8D4,#C9A96E);">
        <div class="thumb-bg"></div>
        <span style="position:relative;z-index:1">üç≥</span>
      </div>
      <div class="card-body">
        <div class="card-cat">Gastronomie</div>
        <h3 class="card-title">Ateliers cuisine & visites de march√©s</h3>
        <p class="card-desc">D√©couvrez les saveurs locales, apprenez de nouvelles recettes et partagez un repas convivial.</p>
        <div class="card-meta">
          <span>üìÖ Mensuel</span>
          <span>üë• 4 √† 7 pers.</span>
        </div>
      </div>
    </div>

    <div class="activity-card reveal">
      <div class="card-thumb" style="background: linear-gradient(135deg,#D4DCE8,#6E7EA9);">
        <div class="thumb-bg"></div>
        <span style="position:relative;z-index:1">üé®</span>
      </div>
      <div class="card-body">
        <div class="card-cat">Cr√©ation</div>
        <h3 class="card-title">Ateliers peinture & artisanat</h3>
        <p class="card-desc">Exprimez votre cr√©ativit√© dans une ambiance d√©tendue, encadr√©s par des artistes passionn√©s.</p>
        <div class="card-meta">
          <span>üìÖ Hebdomadaire</span>
          <span>üë• 7 pers. max</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- COMMENT √áA MARCHE -->
<section id="comment">
  <div class="steps-wrap">
    <div>
      <div class="section-tag reveal">Processus</div>
      <h2 class="section-title reveal">Simple comme<br>un <em>coup de fil</em></h2>
      <div class="steps-list">
        <div class="step reveal">
          <div class="step-num">01</div>
          <div class="step-content">
            <h3>Inscription gratuite</h3>
            <p>Cr√©ez votre profil en quelques minutes. Indiquez vos pr√©f√©rences, vos disponibilit√©s et votre niveau de mobilit√© ‚Äî tout est pris en compte.</p>
          </div>
        </div>
        <div class="step reveal">
          <div class="step-num">02</div>
          <div class="step-content">
            <h3>Choisissez vos sorties</h3>
            <p>Consultez le programme mensuel et r√©servez les activit√©s qui vous correspondent. Nos conseillers sont disponibles pour vous guider par t√©l√©phone.</p>
          </div>
        </div>
        <div class="step reveal">
          <div class="step-num">03</div>
          <div class="step-content">
            <h3>Nous nous occupons du reste</h3>
            <p>Transport, accompagnateur d√©di√©, accessibilit√©, repas si n√©cessaire ‚Äî tout est organis√© pour que vous profitiez pleinement.</p>
          </div>
        </div>
        <div class="step reveal">
          <div class="step-num">04</div>
          <div class="step-content">
            <h3>Profitez & partagez</h3>
            <p>Vivez des moments inoubliables entour√© de nouvelles amiti√©s. Nos membres forment une communaut√© chaleureuse et solidaire.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="steps-visual">
      <div class="visual-circle">üå∏</div>
      <div class="floating-card fc1">
        <span class="fc-dot"></span> Prochaine sortie dans <strong>3 jours</strong>
      </div>
      <div class="floating-card fc2">
        üöå Transport & accompagnement inclus
      </div>
    </div>
  </div>
</section>

<!-- INSCRIPTION (MODAL) -->
<section id="inscription-modal" class="modal" aria-hidden="true">
  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="inscription-title">
    <div class="modal-header">
      <h3 id="inscription-title" class="section-title" style="margin:0;">Rejoindre <em>Vive la Retraite</em></h3>
      <button type="button" class="modal-close" id="close-inscription" aria-label="Fermer">Fermer</button>
    </div>
    <div class="section-sub" style="margin-bottom:1rem;">
      Quelques informations suffisent pour vous rappeler et vous proposer des sorties adapt√©es √† votre rythme, vos envies et votre mobilit√©.
    </div>
    <div class="form-card" style="margin:0;">
      <h3>Formulaire d‚Äôinscription</h3>
      <p>Remplissez ce formulaire pour √™tre rappel√©(e) et cr√©er vos acc√®s √† l‚Äôespace membre.</p>
      <form action="https://backend-uhg3.onrender.com/inscription" method="post">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="prenom"><span>*</span> Pr√©nom</label>
            <input class="form-input" type="text" id="prenom" name="prenom" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="nom"><span>*</span> Nom</label>
            <input class="form-input" type="text" id="nom" name="nom" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="email"><span>*</span> Email</label>
            <input class="form-input" type="email" id="email" name="email" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="inscription-password"><span>*</span> Mot de passe (espace membre)</label>
            <input class="form-input" type="password" id="inscription-password" name="password" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="telephone">T√©l√©phone</label>
            <input class="form-input" type="tel" id="telephone" name="telephone" placeholder="06 67 09 51 43">
          </div>
          <div class="form-group">
            <label class="form-label" for="ville">Ville</label>
            <input class="form-input" type="text" id="ville" name="ville">
          </div>
          <div class="form-group">
            <label class="form-label" for="naissance">Ann√©e de naissance</label>
            <input class="form-input" type="number" id="naissance" name="naissance" min="1925" max="2010" placeholder="1947">
          </div>
          <div class="form-group full">
            <label class="form-label" for="preferences">Types de sorties pr√©f√©r√©es</label>
            <textarea class="form-textarea" id="preferences" name="preferences" placeholder="Exemples : th√©√¢tre, promenade douce, restaurant, jeux de soci√©t√©‚Ä¶"></textarea>
          </div>
        </div>
        <div class="form-row-bottom">
          <small>Les informations restent confidentielles et ne sont jamais partag√©es.</small>
          <div style="display:flex;gap:.6rem;">
            <button type="button" class="btn-outline" id="inscription-go-login">Connexion</button>
            <button type="submit" class="btn-primary">Valider mon inscription</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</section>

<section id="call-modal" class="modal" aria-hidden="true">
  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="call-title">
    <div class="modal-header">
      <h3 id="call-title" class="section-title" style="margin:0;">Appeler Alexandra</h3>
      <button type="button" class="modal-close" id="close-call" aria-label="Fermer">Fermer</button>
    </div>
    <div class="call-number">06 67 09 51 43</div>
    <div class="call-actions">
      <a class="btn-primary" href="tel:+33667095143">Appeler maintenant</a>
      <button type="button" class="btn-outline" id="copy-call-number">Copier le num√©ro</button>
    </div>
    <div class="call-note">Num√©ro: 06 67 09 51 43 ‚Äî disponible 7j/7 en journ√©e.</div>
    <div class="form-card" style="margin:0;">
      <h3>Commentaires r√©cents</h3>
      <div id="call-comments" class="call-comments"></div>
      <div id="call-comments-empty" class="section-sub" style="display:none;">Aucun commentaire publi√© ces 6 derniers mois.</div>
    </div>
  </div>
 </section>

<section id="login-modal" class="modal" aria-hidden="true">
  <div class="modal-panel" role="dialog" aria-modal="true" aria-labelledby="login-title">
    <div class="modal-header">
      <h3 id="login-title" class="section-title" style="margin:0;">Connexion</h3>
      <button type="button" class="modal-close" id="close-login" aria-label="Fermer">Fermer</button>
    </div>
    <div class="form-card" style="margin:0;">
      <form id="login-modal-form">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="login-modal-email"><span>*</span> Email</label>
            <input class="form-input" type="email" id="login-modal-email" name="email" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="login-modal-password"><span>*</span> Mot de passe</label>
            <input class="form-input" type="password" id="login-modal-password" name="password" required>
          </div>
        </div>
        <div class="form-row-bottom">
          <small>Mot de passe oubli√© ? Alexandra peut vous aider par t√©l√©phone.</small>
          <button type="submit" class="btn-primary">Me connecter</button>
        </div>
      </form>
      <div class="form-note" id="login-modal-note"></div>
    </div>
  </div>
</section>

<!-- T√âMOIGNAGES -->
<section id="temoignages">
  <div style="text-align:center;" class="reveal">
    <div class="section-tag" style="justify-content:center;">T√©moignages</div>
    <h2 class="section-title">Ils nous font <em>confiance</em></h2>
  </div>
  <div class="testimonials-grid">
    <div class="testimonial-card reveal">
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p class="testimonial-text">Gr√¢ce √† Alexandra, je ne reste plus seule le week-end. Les sorties au th√©√¢tre sont magnifiquement organis√©es et elle est d'une gentillesse rare.</p>
      <div class="testimonial-author">
        <div class="author-avatar">üë©</div>
        <div>
          <div class="author-name">Marguerite D.</div>
          <div class="author-info">72 ans ‚Äî Membre depuis 3 mois</div>
        </div>
      </div>
    </div>
    <div class="testimonial-card reveal">
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p class="testimonial-text">Mon mari et moi avons red√©couvert la randonn√©e gr√¢ce aux sorties qu'Alexandra organise. Elle pense √† tout, m√™me √† nos r√©gimes alimentaires lors des pique-niques !</p>
      <div class="testimonial-author">
        <div class="author-avatar">üëµ</div>
        <div>
          <div class="author-name">H√©l√®ne & Robert B.</div>
          <div class="author-info">68 et 74 ans ‚Äî Membres depuis 1 an</div>
        </div>
      </div>
    </div>
    <div class="testimonial-card reveal">
      <div class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      <p class="testimonial-text">√Ä 80 ans, je pensais que les voyages c'√©tait fini pour moi. Alexandra m'a prouv√© le contraire. Son service est irr√©prochable et l'ambiance est toujours festive.</p>
      <div class="testimonial-author">
        <div class="author-avatar">üë¥</div>
        <div>
          <div class="author-name">Andr√© M.</div>
          <div class="author-info">80 ans ‚Äî Membre depuis 1 mois</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FAQ -->
<section id="faq">
  <div class="faq-layout">
    <div class="reveal">
      <div class="section-tag">Support</div>
      <h2 class="section-title">Questions <em>fr√©quentes</em></h2>
      <p>Vive la Retraite a √©t√© cr√©√©e par Alexandra, maman de trois enfants et ancienne professionnelle de l‚Äô√©levage animalier. Elle met aujourd‚Äôhui sa douceur, son √©nergie et son sens du contact au service des seniors qui souhaitent continuer √† sortir, d√©couvrir et rencontrer du monde.</p>
      <button type="button" id="open-call" class="faq-contact">üìû Appeler Alexandra</button>
    </div>

    <div class="faq-list reveal">
      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Comment se d√©roule la premi√®re prise de contact ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Apr√®s votre message ou votre inscription, Alexandra vous rappelle personnellement. Elle prend le temps d‚Äô√©couter votre histoire, vos envies, vos craintes √©ventuelles et votre niveau de mobilit√©. Ensemble, vous choisissez les premi√®res sorties les plus adapt√©es pour que vous vous sentiez totalement en confiance.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Les activit√©s sont-elles adapt√©es √† tous les niveaux de mobilit√© ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Oui. Chaque sortie est pens√©e pour les seniors. Alexandra adapte les trajets, la dur√©e de marche, les temps de pause et le choix des lieux. Lors de l‚Äôinscription, vous pouvez indiquer si vous utilisez une canne, un d√©ambulateur ou un fauteuil roulant afin que tout soit pr√©vu en amont.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Le transport est-il inclus dans le prix des sorties ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Le transport est pr√©vu pour la plupart des sorties afin de vous simplifier la vie. Lorsque ce n‚Äôest pas le cas, Alexandra vous explique clairement les options possibles (co-voiturage, transport adapt√©, taxi partenaire) pour que rien ne soit laiss√© au hasard.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Combien de personnes participent √† chaque sortie ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Les sorties se font en petits groupes de 7 personnes maximum pour garder un vrai esprit de groupe. Alexandra vient vous chercher directement √† domicile et vous raccompagne en fin de sortie.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Puis-je venir accompagn√© d'un membre de ma famille ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Bien s√ªr. Les proches sont les bienvenus, que ce soit pour rassurer un parent lors des premi√®res sorties ou pour partager un moment privil√©gi√©. Alexandra vous indique simplement les conditions et les tarifs accompagnants au moment de la r√©servation.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Quels sont les tarifs et y a-t-il des abonnements ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">L‚Äôinscription est gratuite. Les tarifs des sorties d√©pendent du type d‚Äôactivit√© et des services inclus (transport, repas, entr√©es, etc.). Alexandra prend le temps de vous expliquer les diff√©rentes formules par t√©l√©phone afin de trouver ce qui correspond le mieux √† votre budget.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Comment annuler ou modifier une r√©servation ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">La vie r√©serve parfois des impr√©vus. En cas de souci de sant√© ou de changement de planning, il suffit de pr√©venir Alexandra le plus t√¥t possible. Ensemble, vous trouverez une solution bienveillante : report de sortie, avoir, ou autre organisation.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Y a-t-il un accompagnateur pour chaque sortie ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Alexandra accompagne elle-m√™me une grande partie des sorties. Selon la taille du groupe, elle peut √™tre √©paul√©e par d‚Äôautres accompagnants de confiance, choisis pour leur patience, leur √©coute et leur sens du service.</p>
        </div>
      </div>

      <div class="faq-item">
        <button class="faq-question" onclick="toggleFaq(this)">
          Le service est-il disponible dans toute la France ?
          <span class="faq-icon">+</span>
        </button>
        <div class="faq-answer">
          <p class="faq-answer-inner">Vive la Retraite se d√©veloppe progressivement. M√™me si toutes les villes ne sont pas encore couvertes, il est toujours utile de laisser vos coordonn√©es : Alexandra vous contactera pour vous informer des prochaines ouvertures ou des sorties proches de chez vous.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="espace-membre">
  <div class="activities-header reveal" style="align-items:flex-start;">
    <div>
      <div class="section-tag">Espace membre</div>
      <h2 class="section-title">G√©rer <em>mes sorties</em></h2>
      <p class="section-sub">Cr√©ez votre espace membre pour r√©server des sorties en ligne et retrouver en un coup d‚Äô≈ìil les activit√©s auxquelles vous √™tes inscrit(e).</p>
    </div>
    <div class="section-sub">
      Alexandra reste disponible par t√©l√©phone √† chaque √©tape. L‚Äôespace membre simplifie simplement le suivi de vos sorties et de celles de vos proches.
    </div>
  </div>
  <div class="member-grid">
    <div class="form-card reveal">
      <h3>Connexion et suivi</h3>
      <p>Connectez-vous pour voir les sorties r√©serv√©es en ligne.</p>
      <form id="login-form">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="login-email"><span>*</span> Email</label>
            <input class="form-input" type="email" id="login-email" name="email" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="login-password"><span>*</span> Mot de passe</label>
            <input class="form-input" type="password" id="login-password" name="password" required>
          </div>
        </div>
        <div class="form-row-bottom">
          <small>Mot de passe oubli√© ? Alexandra peut vous aider par t√©l√©phone.</small>
          <button type="submit" class="btn-primary">Me connecter</button>
        </div>
      </form>
      <div class="member-status" id="member-status"></div>
      <div class="member-reservations" id="member-reservations"></div>
    </div>
  </div>
</section>

<!-- CTA / CONTACT -->
<section class="cta-section" id="contact">
  <div>
    <div class="section-tag reveal">Contact & accompagnement</div>
    <h2 class="section-title reveal">Alexandra est l√†<br>pour vous <em>et vos proches</em></h2>
    <p class="reveal">Une question, une inqui√©tude, l‚Äôenvie de tester une premi√®re sortie ? Alexandra prend le temps d‚Äô√©couter chaque situation pour proposer des sorties rassurantes, adapt√©es et chaleureuses.</p>
    <div class="cta-highlights reveal">
      <span>üìû <strong>06 67 09 51 43</strong></span>
      <span>‚úâÔ∏è <strong>vivelaretraite82@gmail.com</strong></span>
      <span>ü§ù Premier √©change toujours gratuit et sans engagement.</span>
    </div>
  </div>
  <div class="form-card reveal">
    <h3>√âcrire √† Alexandra</h3>
    <p>Expliquez en quelques mots votre besoin ou la situation du senior concern√©. Alexandra vous r√©pondra ou vous rappellera au plus vite.</p>
    <form action="https://backend-uhg3.onrender.com/contact" method="post">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label" for="contact-nom"><span>*</span> Nom et pr√©nom</label>
          <input class="form-input" type="text" id="contact-nom" name="nom" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="contact-email"><span>*</span> Email</label>
          <input class="form-input" type="email" id="contact-email" name="email" required>
        </div>
        <div class="form-group full">
          <label class="form-label" for="contact-telephone">T√©l√©phone</label>
          <input class="form-input" type="tel" id="contact-telephone" name="telephone" placeholder="06 67 09 51 43">
        </div>
        <div class="form-group full">
          <label class="form-label" for="contact-message"><span>*</span> Votre message</label>
          <textarea class="form-textarea" id="contact-message" name="message" required placeholder="Parlez-nous de vous ou de la personne que vous accompagnez‚Ä¶"></textarea>
        </div>
      </div>
      <div class="form-row-bottom">
        <small>Vous recevrez une r√©ponse personnalis√©e directement par Alexandra.</small>
        <button type="submit" class="btn-primary">Envoyer le message</button>
      </div>
    </form>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="footer-brand">
    <span class="nav-logo">Vive la Retraite</span>
    <img src="haut%20du%20site.jpg" alt="Logo Vive la Retraite" class="footer-logo-img" loading="lazy">
    <p>Des sorties chaleureuses, s√©curis√©es et humaines, imagin√©es par Alexandra pour que chaque senior puisse continuer √† vivre de beaux moments hors de chez soi.</p>
  </div>
  <div class="footer-col">
    <h4>Activit√©s</h4>
    <ul>
      <li><a href="#">Sorties culturelles</a></li>
      <li><a href="#">Plein air</a></li>
      <li><a href="#">Bien-√™tre</a></li>
      <li><a href="#">Ateliers cr√©atifs</a></li>
      <li><a href="#">Gastronomie</a></li>
    </ul>
  </div>
  <div class="footer-col">
    <h4>Contact</h4>
    <ul>
      <li><a href="tel:+33667095143">06 67 09 51 43</a></li>
      <li><a href="mailto:vivelaretraite82@gmail.com">vivelaretraite82@gmail.com</a></li>
      <li><a href="#">Trouver une agence</a></li>
      <li><a href="#espace-membre">Espace membre</a></li>
    </ul>
  </div>
</footer>
<div class="footer-bottom">
  <span>¬© 2025 Vive la Retraite ‚Äî Tous droits r√©serv√©s</span>
  <span><a href="#" style="color:inherit;text-decoration:none;margin-right:1.5rem;">Mentions l√©gales</a><a href="#" style="color:inherit;text-decoration:none;">Confidentialit√©</a></span>
</div>

<script>
  const API_BASE = 'https://backend-uhg3.onrender.com';
  const ADMIN_EMAIL = 'vivelaretraite82@gmail.com';
  let authToken = window.localStorage.getItem('vivelaretraite-token') || '';
  let currentUser = null;

  const reveals = document.querySelectorAll('.reveal');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, i) => {
      if (entry.isIntersecting) {
        setTimeout(() => entry.target.classList.add('visible'), i * 80);
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.12 });
  reveals.forEach(el => observer.observe(el));

  function toggleFaq(btn) {
    const item = btn.closest('.faq-item');
    const isOpen = item.classList.contains('open');
    document.querySelectorAll('.faq-item.open').forEach(i => i.classList.remove('open'));
    if (!isOpen) item.classList.add('open');
  }

  window.addEventListener('scroll', () => {
    const nav = document.querySelector('nav');
    nav.style.padding = window.scrollY > 40 ? '1rem 4rem' : '1.4rem 4rem';
  });

  const feedbackBanner = document.getElementById('feedback-banner');
  if (feedbackBanner) {
    const params = new URLSearchParams(window.location.search);
    let message = '';
    if (params.get('inscription') === 'ok') {
      message = 'Merci, votre inscription a bien √©t√© enregistr√©e.';
    } else if (params.get('contact') === 'ok') {
      message = 'Merci pour votre message, Alexandra vous r√©pondra rapidement.';
    }
    if (message) {
      feedbackBanner.textContent = message;
      feedbackBanner.classList.add('visible');
      setTimeout(() => {
        feedbackBanner.classList.remove('visible');
      }, 6000);
    }
  }

  function setMemberStatus(text) {
    const el = document.getElementById('member-status');
    if (el) el.textContent = text || '';
  }

  function renderReservations(rows) {
    const wrap = document.getElementById('member-reservations');
    if (!wrap) return;
    if (!authToken) {
      wrap.textContent = 'Connectez-vous pour voir vos sorties r√©serv√©es.';
      return;
    }
    if (!Array.isArray(rows) || rows.length === 0) {
      wrap.textContent = 'Aucune sortie r√©serv√©e pour le moment.';
      return;
    }
    wrap.innerHTML = '<h4>Mes sorties r√©serv√©es</h4>' + rows.map(r => {
      const id = r.id;
      const titre = r.titre ? String(r.titre) : '';
      const date = r.date_iso ? String(r.date_iso) : '';
      const lieu = r.lieu ? String(r.lieu) : '';
      const status = String(r.status || 'active');
      const cancelled = status === 'cancelled';
      const metaBase = `${date}${lieu ? ' ‚Ä¢ ' + lieu : ''}`;
      const meta = cancelled ? (metaBase ? metaBase + ' ‚Äî Annul√©e' : 'Annul√©e') : metaBase;
      return `
        <div class="reservation-item${cancelled ? ' reservation-item-cancelled' : ''}">
          <div>
            <div class="reservation-item-title">${titre}</div>
            <div class="reservation-item-meta">${meta}</div>
          </div>
          ${cancelled ? '' : `<button class="btn-outline reservation-cancel" data-id="${id}" data-titre="${titre}" style="font-size:.75rem;padding:.3rem .7rem;margin-left:auto;">Annuler</button>`}
        </div>
      `;
    }).join('');
    wrap.querySelectorAll('.reservation-cancel').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const id = e.currentTarget.getAttribute('data-id');
        const titre = e.currentTarget.getAttribute('data-titre') || '';
        if (!id || !authToken) return;
        const ok = window.confirm('Annuler la r√©servation pour "' + titre + '" ?');
        if (!ok) return;
        cancelReservation(id, titre);
      });
    });
  }

  function updateMessagingVisibility() {
    const guest = document.getElementById('messaging-guest');
    const thread = document.getElementById('messaging-thread');
    if (!guest || !thread) return;
    if (!authToken) {
      guest.style.display = 'block';
      guest.textContent = 'Connectez-vous √† votre espace membre pour envoyer et lire vos messages.';
      thread.style.display = 'none';
      return;
    }
    const email = currentUser && currentUser.email ? String(currentUser.email).trim().toLowerCase() : '';
    if (email === ADMIN_EMAIL) {
      guest.style.display = 'block';
      guest.textContent = 'Depuis ce compte administrateur, utilisez le panneau Admin pour voir tous les messages des membres.';
      thread.style.display = 'none';
    } else {
      guest.style.display = 'none';
      thread.style.display = 'block';
    }
  }

  function renderMessages(rows) {
    const list = document.getElementById('messages-list');
    if (!list) return;
    if (!Array.isArray(rows) || rows.length === 0) {
      list.innerHTML = '<div class="section-sub">Aucun message pour le moment. √âcrivez √† Alexandra pour commencer la conversation.</div>';
      return;
    }
    const myId = currentUser && currentUser.id;
    let lastIncoming = '';
    list.innerHTML = rows.map(m => {
      const mine = myId && m.sender_id === myId;
      const cls = mine ? 'me' : 'them';
      const body = m.body ? String(m.body) : '';
      const created = m.created_at ? String(m.created_at) : '';
      const dateStr = created ? created.replace('T', ' ').slice(0, 16) : '';
      if (!mine && created && (!lastIncoming || created > lastIncoming)) lastIncoming = created;
      return `
        <div class="message-item ${cls}">
          <div>
            <div class="message-bubble">${body}</div>
            <div class="message-meta">${dateStr}</div>
          </div>
        </div>
      `;
    }).join('');
    list.scrollTop = list.scrollHeight;
    const badgeSeenKey = 'vivelaretraite-messages-lastSeen';
    if (lastIncoming) {
      const stored = window.localStorage.getItem(badgeSeenKey) || '';
      const hasUnread = !stored || lastIncoming > stored;
      setNavMessagesBadge(hasUnread);
    } else {
      setNavMessagesBadge(false);
    }
  }

  function loadMessages() {
    if (!authToken || (currentUser && String(currentUser.email || '').trim().toLowerCase() === ADMIN_EMAIL)) return;
    fetch(API_BASE + '/messages', {
      headers: { Authorization: 'Bearer ' + authToken }
    })
      .then(r => r.ok ? r.json() : [])
      .then(rows => renderMessages(rows))
      .catch(() => {});
  }

  const messageForm = document.getElementById('message-form');
  const messageText = document.getElementById('message-text');
  if (messageForm) {
    messageForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!authToken || (currentUser && String(currentUser.email || '').trim().toLowerCase() === ADMIN_EMAIL)) {
        setMemberStatus('Connectez-vous avec un compte membre pour envoyer un message.');
        return;
      }
      const body = messageText ? String(messageText.value || '').trim() : '';
      if (!body) return;
      fetch(API_BASE + '/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: 'Bearer ' + authToken
        },
        body: JSON.stringify({ body })
      })
        .then(r => r.ok ? r.json() : Promise.reject())
        .then(() => {
          if (messageText) messageText.value = '';
          loadMessages();
        })
        .catch(() => {});
    });
  }

  function loadReservations() {
    if (!authToken) {
      renderReservations([]);
      return;
    }
    fetch(API_BASE + '/me/reservations', {
      headers: { Authorization: 'Bearer ' + authToken }
    })
      .then(r => r.ok ? r.json() : [])
      .then(rows => renderReservations(rows))
      .catch(() => {});
  }

  function reserveSortie(id, titre) {
    if (!authToken) return;
    fetch(API_BASE + '/sorties/' + encodeURIComponent(id) + '/reserver', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: 'Bearer ' + authToken
      }
    })
      .then(r => r.json().then(data => ({ ok: r.ok, data })))
      .then(({ ok }) => {
        if (ok) {
          setMemberStatus('Votre r√©servation pour "' + titre + '" est enregistr√©e.');
          loadReservations();
        } else {
          setMemberStatus('Impossible d‚Äôenregistrer la r√©servation. Merci de r√©essayer.');
        }
      })
      .catch(() => {
        setMemberStatus('Impossible d‚Äôenregistrer la r√©servation. Merci de r√©essayer.');
      });
  }

  function cancelReservation(reservationId, titre) {
    if (!authToken) return;
    fetch(API_BASE + '/me/reservations/' + encodeURIComponent(reservationId), {
      method: 'DELETE',
      headers: {
        Authorization: 'Bearer ' + authToken
      }
    })
      .then(r => r.json().then(data => ({ ok: r.ok, data })))
      .then(({ ok }) => {
        if (ok) {
          setMemberStatus('Votre r√©servation pour "' + titre + '" est annul√©e.');
          const wrap = document.getElementById('member-reservations');
          if (wrap) {
            const item = wrap.querySelector('.reservation-cancel[data-id="' + reservationId + '"]');
            if (item) {
              const container = item.closest('.reservation-item');
              if (container) {
                container.classList.add('reservation-item-cancelled');
                const meta = container.querySelector('.reservation-item-meta');
                if (meta && !meta.textContent.includes('Annul√©e')) {
                  meta.textContent = (meta.textContent ? meta.textContent + ' ‚Äî ' : '') + 'Annul√©e';
                }
              }
              item.style.display = 'none';
            }
          }
        } else {
          setMemberStatus('Impossible d‚Äôannuler la r√©servation. Merci de r√©essayer.');
        }
      })
      .catch(() => {
        setMemberStatus('Impossible d‚Äôannuler la r√©servation. Merci de r√©essayer.');
      });
  }

  function renderSorties(rows) {
    const list = document.getElementById('sorties-list');
    const empty = document.getElementById('sorties-empty');
    const isAdmin = !!(currentUser && String(currentUser.email || '').trim().toLowerCase() === ADMIN_EMAIL);
    if (!Array.isArray(rows) || rows.length === 0) {
      empty.style.display = 'block';
      return;
    }
    if (empty) empty.style.display = 'none';
    list.innerHTML = rows.map(s => {
      const id = s.id ? String(s.id) : '';
      const safeTitre = s.titre ? String(s.titre) : '';
      const cat = s.categorie ? String(s.categorie) : '';
      const catLabel = cat ? (categoryEmoji(cat) + ' ' + cat) : 'Sortie';
      const safeDate = s.date_iso ? String(s.date_iso) : '';
      const safeDesc = s.description ? String(s.description) : '';
      const safeLieu = s.lieu ? String(s.lieu) : '';
      const img = s.image_path ? String(s.image_path) : '';
      const thumbStyle = img
        ? `background: url('${img}') center/cover no-repeat;`
        : `background: linear-gradient(135deg,#E8D5B0,#C9A96E);`;
      return `
        <div class="activity-card reveal">
          <div class="card-thumb" style="${thumbStyle}">
            <div class="thumb-bg"></div>
            <span style="position:relative;z-index:1">${cat ? categoryEmoji(cat) : 'üìÖ'}</span>
          </div>
          <div class="card-body">
            <div class="card-cat">${catLabel}</div>
            <h3 class="card-title">${safeTitre}</h3>
            <p class="card-desc">${safeDesc}</p>
            <div class="card-meta">
              <span>${safeDate}</span>${safeLieu ? '<span> ‚Ä¢ ' + safeLieu + '</span>' : ''}
            </div>
            <div style="margin-top:1rem;display:flex;gap:.5rem;align-items:center;justify-content:space-between;flex-wrap:wrap;">
              <a href="#espace-membre" class="btn-primary sortie-reserver" data-id="${id}" data-titre="${encodeURIComponent(safeTitre)}">R√©server</a>
              ${isAdmin ? `<button type="button" class="admin-delete-btn sortie-delete-btn" data-id="${id}">Supprimer</button>` : ''}
            </div>
          </div>
        </div>
      `;
    }).join('');
    list.querySelectorAll('.sortie-reserver').forEach(a => {
      a.addEventListener('click', (e) => {
        e.preventDefault();
        const id = e.currentTarget.getAttribute('data-id');
        const titre = decodeURIComponent(e.currentTarget.getAttribute('data-titre') || '');
        if (!id) return;
        if (!authToken) {
          const section = document.getElementById('espace-membre');
          if (section) section.scrollIntoView({ behavior: 'smooth' });
          setMemberStatus('Cr√©ez un compte ou connectez-vous pour r√©server "' + titre + '".');
          const pref = document.getElementById('preferences');
          if (pref && titre) pref.value = `Sortie : ${titre}`;
          return;
        }
        reserveSortie(id, titre);
      });
    });
    if (isAdmin) {
      list.querySelectorAll('.sortie-delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const id = btn.getAttribute('data-id');
          if (!id || !authToken) return;
          const email = currentUser && currentUser.email ? String(currentUser.email).trim().toLowerCase() : '';
          if (email !== ADMIN_EMAIL) return;
          const ok = window.confirm('Supprimer d√©finitivement cette sortie ?');
          if (!ok) return;
          fetch(API_BASE + '/admin/sorties/' + encodeURIComponent(id), {
            method: 'DELETE',
            headers: { Authorization: 'Bearer ' + authToken }
          })
            .then(r => r.ok ? r.json() : Promise.reject())
            .then(() => {
              fetchAndRenderSorties();
            })
            .catch(() => {});
        });
      });
    }
  }

  function fetchAndRenderSorties() {
    fetch(API_BASE + '/api/sorties')
      .then(r => r.ok ? r.json() : [])
      .then(rows => {
        renderSorties(rows);
        renderAdminSorties(rows);
      })
      .catch(() => {});
  }
  fetchAndRenderSorties();

  function categoryEmoji(c) {
    const k = String(c || '').toLowerCase();
    if (k.includes('cin√©ma') || k.includes('cinema')) return 'üé¨';
    if (k.includes('mus√©e') || k.includes('musee')) return 'üñºÔ∏è';
    if (k.includes('th√©√¢tre') || k.includes('theatre')) return 'üé≠';
    if (k.includes('zoo')) return 'üêæ';
    if (k.includes('balade') || k.includes('promenade')) return 'üö∂‚Äç‚ôÄÔ∏è';
    if (k.includes('march√©') || k.includes('marche')) return 'üß∫';
    if (k.includes('atelier')) return 'üé®';
    if (k.includes('repas') || k.includes('d√©jeuner') || k.includes('diner') || k.includes('d√Æner')) return 'üç≤';
    if (k.includes('concert') || k.includes('chorale')) return 'üé∂';
    if (k.includes('guinguette') || k.includes('danse')) return 'üíÉ';
    if (k.includes('laser')) return 'üéØ';
    if (k.includes('jardin')) return 'üåø';
    if (k.includes('insolite')) return 'üß≠';
    return 'üìå';
  }

  function renderAdminSorties(rows) {
    const wrap = document.getElementById('admin-sorties-list');
    if (!wrap) return;
    if (!Array.isArray(rows) || rows.length === 0) {
      wrap.innerHTML = '<div class="section-sub">Aucune sortie enregistr√©e.</div>';
      return;
    }
    wrap.innerHTML = rows.map(s => {
      const id = s.id ? String(s.id) : '';
      const titre = s.titre ? String(s.titre) : '';
      const date = s.date_iso ? String(s.date_iso) : '';
      const lieu = s.lieu ? String(s.lieu) : '';
      const cat = s.categorie ? String(s.categorie) : '';
      const catLabel = cat ? (categoryEmoji(cat) + ' ' + cat) : '';
      const img = s.image_path ? String(s.image_path) : '';
      return `
        <div class="admin-sortie-item">
          <div class="admin-sortie-main">
            <div>${img ? 'üñºÔ∏è ' : ''}${titre}</div>
            <div class="admin-sortie-meta">${catLabel}${catLabel && (date || lieu) ? ' ‚Ä¢ ' : ''}${date}${lieu ? ' ‚Ä¢ ' + lieu : ''}</div>
          </div>
          <div class="admin-sortie-actions">
            <button type="button" class="admin-delete-btn" data-id="${id}">Supprimer</button>
          </div>
        </div>
      `;
    }).join('');
    wrap.querySelectorAll('.admin-delete-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-id');
        if (!id || !authToken) return;
        fetch(API_BASE + '/admin/sorties/' + encodeURIComponent(id), {
          method: 'DELETE',
          headers: { Authorization: 'Bearer ' + authToken }
        })
          .then(r => r.ok ? r.json() : Promise.reject())
          .then(() => {
            fetchAndRenderSorties();
          })
          .catch(() => {});
      });
    });
  }

  const adminSortieForm = document.getElementById('admin-sortie-form');
  const adminSortiesNote = document.getElementById('admin-sorties-note');
  const adminThreadsWrap = document.getElementById('admin-threads');
  const adminMessagesList = document.getElementById('admin-messages-list');
  const adminMessageForm = document.getElementById('admin-message-form');
  const adminMessageText = document.getElementById('admin-message-text');
  const adminThreadHeader = document.getElementById('admin-thread-header');
  let adminActiveUserId = null;
  const adminImageInput = document.getElementById('admin-sortie-image');
  const adminImageHelp = document.getElementById('admin-image-help');
  if (adminImageInput) {
    adminImageInput.addEventListener('change', () => {
      if (!adminImageHelp) return;
      const f = adminImageInput.files && adminImageInput.files[0] ? adminImageInput.files[0] : null;
      if (!f) {
        adminImageHelp.textContent = 'Formats accept√©s: JPG, PNG, WEBP ‚Ä¢ Max 5 Mo.';
        return;
      }
      const okType = ['image/jpeg', 'image/png', 'image/webp'].includes(f.type);
      const okSize = f.size <= 5 * 1024 * 1024;
      if (okType && okSize) {
        adminImageHelp.textContent = `Fichier s√©lectionn√©: ${f.name} ‚Äî OK (‚â§ 5 Mo, JPG/PNG/WEBP)`;
      } else if (!okType) {
        adminImageHelp.textContent = 'Format non pris en charge. Utilisez JPG, PNG ou WEBP (max 5 Mo).';
      } else {
        adminImageHelp.textContent = 'Image trop lourde. Taille maximale 5 Mo.';
      }
    });
  }
  if (adminSortieForm) {
    adminSortieForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!authToken) return;
      if (adminSortiesNote) adminSortiesNote.textContent = '';
      const formData = new FormData(adminSortieForm);
      const categorie = String(formData.get('categorie') || '').trim();
      const titre = String(formData.get('titre') || '').trim();
      const date_iso = String(formData.get('date_iso') || '').trim();
      const lieu = String(formData.get('lieu') || '').trim();
      const description = String(formData.get('description') || '').trim();
      const fileInput = document.getElementById('admin-sortie-image');
      const file = fileInput && fileInput.files && fileInput.files[0] ? fileInput.files[0] : null;
      if (!categorie) {
        if (adminSortiesNote) adminSortiesNote.textContent = 'Merci de choisir une cat√©gorie.';
        return;
      }
      if (!titre) {
        if (adminSortiesNote) adminSortiesNote.textContent = 'Merci d‚Äôindiquer un titre.';
        return;
      }
      function sendPayload(image_base64) {
        fetch(API_BASE + '/admin/api/sorties', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: 'Bearer ' + authToken
          },
          body: JSON.stringify({ titre, date_iso, lieu, description, categorie, image_base64 })
        })
          .then(r => r.ok ? r.json() : Promise.reject())
          .then(() => {
            adminSortieForm.reset();
            if (adminSortiesNote) adminSortiesNote.textContent = 'Sortie cr√©√©e.';
            fetchAndRenderSorties();
          })
          .catch(() => {
            if (adminSortiesNote) adminSortiesNote.textContent = 'Erreur lors de la cr√©ation de la sortie.';
          });
      }
      if (file) {
        if (file.size > 5 * 1024 * 1024) {
          if (adminSortiesNote) adminSortiesNote.textContent = 'Image trop lourde (max 5 Mo).';
          return;
        }
        const reader = new FileReader();
        reader.onload = () => sendPayload(String(reader.result || ''));
        reader.onerror = () => sendPayload(null);
        reader.readAsDataURL(file);
      } else {
        sendPayload(null);
      }
    });
  }

  function loadAdminReservations() {
    const tbody = document.getElementById('admin-reservations-body');
    const empty = document.getElementById('admin-reservations-empty');
    const table = document.getElementById('admin-reservations-table');
    if (!tbody || !authToken) return;
    fetch(API_BASE + '/admin/reservations', {
      headers: { Authorization: 'Bearer ' + authToken }
    })
      .then(r => r.ok ? r.json() : [])
      .then(rows => {
        if (!Array.isArray(rows) || rows.length === 0) {
          if (empty) empty.style.display = 'block';
          if (table) table.style.display = 'none';
          return;
        }
        if (empty) empty.style.display = 'none';
        if (table) table.style.display = 'table';
        tbody.innerHTML = rows.map(r => {
          const date = r.created_at ? String(r.created_at).slice(0, 10) : '';
          const nom = [r.prenom, r.nom].filter(Boolean).join(' ') || r.email || '';
          const sortie = r.titre ? String(r.titre) : '';
          const contact = r.telephone || r.email || '';
          return `
            <tr>
              <td>${date}</td>
              <td>${nom}</td>
              <td>${sortie}</td>
              <td>${contact}</td>
            </tr>
          `;
        }).join('');
      })
      .catch(() => {});
  }

  function renderAdminThreads(rows) {
    if (!adminThreadsWrap) return;
    if (!Array.isArray(rows) || rows.length === 0) {
      adminThreadsWrap.innerHTML = '<div class="section-sub">Aucune conversation pour le moment.</div>';
      return;
    }
    adminThreadsWrap.innerHTML = rows.map(t => {
      const id = t.other_id;
      const name = [t.prenom, t.nom].filter(Boolean).join(' ') || t.email || ('Membre #' + id);
      const last = t.last_created ? String(t.last_created).replace('T', ' ').slice(0, 16) : '';
      const active = adminActiveUserId === id ? 'active' : '';
      return `
        <div class="admin-thread ${active}" data-id="${id}">
          <div class="admin-thread-title">${name}</div>
          <div class="admin-thread-meta">${last}</div>
        </div>
      `;
    }).join('');
    adminThreadsWrap.querySelectorAll('.admin-thread').forEach(el => {
      el.addEventListener('click', () => {
        const id = parseInt(el.getAttribute('data-id') || '', 10);
        if (!id || !authToken) return;
        adminActiveUserId = id;
        renderAdminThreads(rows);
        if (adminThreadHeader) {
          const t = rows.find(r => r.other_id === id);
          const name = t ? ([t.prenom, t.nom].filter(Boolean).join(' ') || t.email || ('Membre #' + id)) : ('Membre #' + id);
          adminThreadHeader.textContent = 'Conversation avec ' + name;
        }
        loadAdminMessages();
      });
    });
  }

  function renderAdminMessages(rows) {
    if (!adminMessagesList) return;
    if (!Array.isArray(rows) || rows.length === 0) {
      adminMessagesList.innerHTML = '<div class="section-sub">Aucun message encore √©chang√©.</div>';
      return;
    }
    const myId = currentUser && currentUser.id;
    adminMessagesList.innerHTML = rows.map(m => {
      const mine = myId && m.sender_id === myId;
      const cls = mine ? 'me' : 'them';
      const body = m.body ? String(m.body) : '';
      const dateStr = m.created_at ? String(m.created_at).replace('T', ' ').slice(0, 16) : '';
      return `
        <div class="message-item ${cls}">
          <div>
            <div class="message-bubble">${body}</div>
            <div class="message-meta">${dateStr}</div>
          </div>
        </div>
      `;
    }).join('');
    adminMessagesList.scrollTop = adminMessagesList.scrollHeight;
  }

  function loadAdminThreads() {
    if (!authToken || !(currentUser && String(currentUser.email || '').trim().toLowerCase() === ADMIN_EMAIL)) return;
    fetch(API_BASE + '/admin/messages/threads', {
      headers: { Authorization: 'Bearer ' + authToken }
    })
      .then(r => r.ok ? r.json() : [])
      .then(rows => renderAdminThreads(rows))
      .catch(() => {});
  }

  function loadAdminMessages() {
    if (!authToken || !adminActiveUserId) return;
    fetch(API_BASE + '/messages?user_id=' + encodeURIComponent(adminActiveUserId), {
      headers: { Authorization: 'Bearer ' + authToken }
    })
      .then(r => r.ok ? r.json() : [])
      .then(rows => renderAdminMessages(rows))
      .catch(() => {});
  }

  if (adminMessageForm) {
    adminMessageForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!authToken || !adminActiveUserId) return;
      const body = adminMessageText ? String(adminMessageText.value || '').trim() : '';
      if (!body) return;
      fetch(API_BASE + '/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Authorization: 'Bearer ' + authToken
        },
        body: JSON.stringify({ body, user_id: adminActiveUserId })
      })
        .then(r => r.ok ? r.json() : Promise.reject())
        .then(() => {
          if (adminMessageText) adminMessageText.value = '';
          loadAdminMessages();
          loadAdminThreads();
        })
        .catch(() => {});
    });
  }

  const inscriptionModal = document.getElementById('inscription-modal');
  const openInscriptionBtn = document.getElementById('open-inscription');
  const closeInscriptionBtn = document.getElementById('close-inscription');
  function openInscription() {
    if (!inscriptionModal) return;
    inscriptionModal.classList.add('open');
    inscriptionModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }
  function closeInscription() {
    if (!inscriptionModal) return;
    inscriptionModal.classList.remove('open');
    inscriptionModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }
  if (openInscriptionBtn) openInscriptionBtn.addEventListener('click', openInscription);
  if (closeInscriptionBtn) closeInscriptionBtn.addEventListener('click', closeInscription);
  if (inscriptionModal) {
    inscriptionModal.addEventListener('click', (e) => {
      if (e.target === inscriptionModal) closeInscription();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && inscriptionModal.classList.contains('open')) closeInscription();
    });
  }

  const callModal = document.getElementById('call-modal');
  const openCallBtn = document.getElementById('open-call');
  const closeCallBtn = document.getElementById('close-call');
  const copyCallBtn = document.getElementById('copy-call-number');
  let callCommentsLoaded = false;
  function openCall() {
    if (!callModal) return;
    callModal.classList.add('open');
    callModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    if (!callCommentsLoaded) {
      loadCallComments();
      callCommentsLoaded = true;
    }
  }
  function closeCall() {
    if (!callModal) return;
    callModal.classList.remove('open');
    callModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }
  function daysBetween(a, b) {
    return Math.floor((a.getTime() - b.getTime()) / (1000 * 60 * 60 * 24));
  }
  function loadCallComments() {
    const wrap = document.getElementById('call-comments');
    const empty = document.getElementById('call-comments-empty');
    if (!wrap) return;
    fetch(API_BASE + '/api/comments')
      .then(r => r.ok ? r.json() : [])
      .then(rows => {
        const now = new Date();
        const sixMonthsDays = 183;
        const safeRows = Array.isArray(rows) ? rows : [];
        const filtered = safeRows.filter(c => {
          const d = c.created_at ? new Date(c.created_at) : null;
          if (!d || isNaN(d.getTime())) return false;
          return daysBetween(now, d) <= sixMonthsDays;
        });
        if (filtered.length === 0) {
          if (empty) empty.style.display = 'block';
          return;
        }
        wrap.innerHTML = filtered.map(c => {
          const name = c.name || c.prenom || c.user || 'Membre';
          const txt = c.comment || c.message || c.text || '';
          const d = c.created_at ? new Date(c.created_at) : null;
          const dateStr = d ? d.toLocaleDateString('fr-FR') : '';
          return (
            '<div class="call-comment">' +
              '<div class="cc-meta">' + name + ' ‚Äî ' + dateStr + '</div>' +
              '<div class="cc-text">' + String(txt) + '</div>' +
            '</div>'
          );
        }).join('');
      })
      .catch(() => {});
  }
  if (openCallBtn) openCallBtn.addEventListener('click', openCall);
  if (closeCallBtn) closeCallBtn.addEventListener('click', closeCall);
  if (copyCallBtn) {
    copyCallBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText('06 67 09 51 43');
        copyCallBtn.textContent = 'Num√©ro copi√©';
        setTimeout(() => { copyCallBtn.textContent = 'Copier le num√©ro'; }, 1500);
      } catch {}
    });
  }
  if (callModal) {
    callModal.addEventListener('click', (e) => {
      if (e.target === callModal) closeCall();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && callModal.classList.contains('open')) closeCall();
    });
  }

  const inscriptionGoLogin = document.getElementById('inscription-go-login');
  if (inscriptionGoLogin) {
    inscriptionGoLogin.addEventListener('click', () => {
      closeInscription();
      openLogin();
    });
  }

  function setNavMessagesBadge(on) {
    const b1 = document.getElementById('nav-messages-badge');
    const b2 = document.getElementById('nav-messages-badge-mobile');
    const display = on ? 'inline-block' : 'none';
    if (b1) b1.style.display = display;
    if (b2) b2.style.display = display;
    if (!on) window.localStorage.setItem('vivelaretraite-messages-lastSeen', new Date().toISOString());
  }

  const navMenuToggle = document.getElementById('nav-menu-toggle');
  const navDrawer = document.getElementById('nav-drawer');
  const navDrawerClose = document.getElementById('nav-drawer-close');
  function openNavDrawer() {
    if (!navDrawer) return;
    navDrawer.classList.add('open');
    navDrawer.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  }
  function closeNavDrawer() {
    if (!navDrawer) return;
    navDrawer.classList.remove('open');
    navDrawer.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }
  if (navMenuToggle) navMenuToggle.addEventListener('click', openNavDrawer);
  if (navDrawerClose) navDrawerClose.addEventListener('click', closeNavDrawer);
  if (navDrawer) {
    navDrawer.addEventListener('click', (e) => {
      if (e.target === navDrawer) closeNavDrawer();
    });
    const drawerLinks = navDrawer.querySelectorAll('.nav-drawer-links a');
    drawerLinks.forEach(a => {
      a.addEventListener('click', () => {
        closeNavDrawer();
      });
    });
  }

  const navMessagesLink = document.getElementById('nav-messages-link');
  const navMessagesLinkMobile = document.getElementById('nav-messages-link-mobile');
  if (navMessagesLink) {
    navMessagesLink.addEventListener('click', () => {
      setNavMessagesBadge(false);
    });
  }
  if (navMessagesLinkMobile) {
    navMessagesLinkMobile.addEventListener('click', () => {
      setNavMessagesBadge(false);
    });
  }

  const navLoginBtn = document.getElementById('nav-login');
  const navLogoutBtn = document.getElementById('nav-logout');
  const navAdminItem = document.getElementById('nav-admin-item');
  const navAdminItemMobile = document.getElementById('nav-admin-item-mobile');
  const adminPanel = document.getElementById('admin-panel');
  let messagesPollTimer = null;
  function updateNavAuth() {
    const hasToken = !!authToken;
    if (navLoginBtn) navLoginBtn.style.display = hasToken ? 'none' : 'inline-block';
    const openInscr = document.getElementById('open-inscription');
    if (openInscr) openInscr.style.display = hasToken ? 'none' : 'inline-block';
    if (navLogoutBtn) navLogoutBtn.style.display = hasToken ? 'inline-block' : 'none';
    const isAdmin = !!(currentUser && String(currentUser.email || '').trim().toLowerCase() === ADMIN_EMAIL);
    if (navAdminItem) navAdminItem.style.display = isAdmin ? 'inline-block' : 'none';
    if (navAdminItemMobile) navAdminItemMobile.style.display = isAdmin ? 'list-item' : 'none';
    if (adminPanel) adminPanel.style.display = isAdmin ? 'block' : 'none';
    updateMessagingVisibility();
  }
  function startMessagesPolling() {
    if (messagesPollTimer || !authToken) return;
    messagesPollTimer = setInterval(() => {
      if (!authToken) {
        clearInterval(messagesPollTimer);
        messagesPollTimer = null;
        setNavMessagesBadge(false);
        return;
      }
      const email = currentUser && currentUser.email ? String(currentUser.email).trim().toLowerCase() : '';
      if (email && email === ADMIN_EMAIL) {
        loadAdminThreads();
        loadAdminReservations();
      } else {
        loadMessages();
      }
    }, 5000);
  }
  function openAdminPanel() {
    if (currentUser && String(currentUser.email || '').trim().toLowerCase() === ADMIN_EMAIL) {
      loadAdminReservations();
      loadAdminThreads();
    }
  }
  if (navAdminItem) {
    navAdminItem.addEventListener('click', openAdminPanel);
  }
  if (navAdminItemMobile) {
    navAdminItemMobile.addEventListener('click', openAdminPanel);
  }
  const loginModal = document.getElementById('login-modal');
  const closeLoginBtn = document.getElementById('close-login');
  function openLogin() {
    if (!loginModal) return;
    loginModal.classList.add('open');
    loginModal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    const emailField = document.getElementById('login-modal-email');
    if (emailField) setTimeout(() => emailField.focus(), 50);
  }
  function closeLogin() {
    if (!loginModal) return;
    loginModal.classList.remove('open');
    loginModal.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
  }
  if (navLoginBtn) navLoginBtn.addEventListener('click', openLogin);
  if (closeLoginBtn) closeLoginBtn.addEventListener('click', closeLogin);
  if (loginModal) {
    loginModal.addEventListener('click', (e) => {
      if (e.target === loginModal) closeLogin();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && loginModal.classList.contains('open')) closeLogin();
    });
  }

  const loginModalForm = document.getElementById('login-modal-form');
  const loginModalNote = document.getElementById('login-modal-note');
  if (loginModalForm) {
    loginModalForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if (loginModalNote) loginModalNote.textContent = '';
      const formData = new FormData(loginModalForm);
      const email = String(formData.get('email') || '').trim();
      const password = String(formData.get('password') || '');
      if (!email || !password) {
        if (loginModalNote) loginModalNote.textContent = 'Merci de renseigner votre email et votre mot de passe.';
        return;
      }
      fetch(API_BASE + '/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      })
        .then(r => r.json().then(data => ({ ok: r.ok, data })))
        .then(({ ok, data }) => {
          if (ok && data && data.token && data.user) {
            authToken = data.token;
            window.localStorage.setItem('vivelaretraite-token', authToken);
            currentUser = data.user;
            const userEmail = data.user.email || email;
            setMemberStatus('Connect√©(e) en tant que ' + userEmail + '.');
            loadReservations();
            updateNavAuth();
            loadMessages();
            startMessagesPolling();
            closeLogin();
          } else {
            const code = data && data.error;
            let msg = 'Impossible de vous connecter.';
            if (code === 'invalid_credentials') msg = 'Email ou mot de passe incorrect.';
            if (loginModalNote) loginModalNote.textContent = msg;
          }
        })
        .catch(() => {
          if (loginModalNote) loginModalNote.textContent = 'Erreur r√©seau. Merci de r√©essayer.';
        });
    });
  }
  if (navLogoutBtn) {
    navLogoutBtn.addEventListener('click', () => {
      authToken = '';
      window.localStorage.removeItem('vivelaretraite-token');
      currentUser = null;
      setMemberStatus('Vous √™tes d√©connect√©(e).');
      renderReservations([]);
      updateNavAuth();
    });
  }

  const loginForm = document.getElementById('login-form');

  if (loginForm) {
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      setMemberStatus('');
      const formData = new FormData(loginForm);
      const email = String(formData.get('email') || '').trim();
      const password = String(formData.get('password') || '');
      if (!email || !password) {
        setMemberStatus('Merci de renseigner votre email et votre mot de passe.');
        return;
      }
      fetch(API_BASE + '/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      })
        .then(r => r.json().then(data => ({ ok: r.ok, data })))
        .then(({ ok, data }) => {
          if (ok && data && data.token && data.user) {
            authToken = data.token;
            window.localStorage.setItem('vivelaretraite-token', authToken);
            currentUser = data.user;
            const userEmail = data.user.email || email;
            setMemberStatus('Connect√©(e) en tant que ' + userEmail + '.');
            loadReservations();
            if (typeof updateNavAuth === 'function') updateNavAuth();
            loadMessages();
            startMessagesPolling();
          } else {
            const code = data && data.error;
            let msg = 'Impossible de vous connecter.';
            if (code === 'invalid_credentials') msg = 'Email ou mot de passe incorrect.';
            setMemberStatus(msg);
          }
        })
        .catch(() => {
          setMemberStatus('Erreur r√©seau. Merci de r√©essayer.');
        });
    });
  }

  if (authToken) {
    fetch(API_BASE + '/me', {
      headers: { Authorization: 'Bearer ' + authToken }
    })
      .then(r => r.ok ? r.json() : null)
      .then(user => {
        if (user && user.email) {
          currentUser = user;
          setMemberStatus('Connect√©(e) en tant que ' + user.email + '.');
          loadReservations();
          if (typeof updateNavAuth === 'function') updateNavAuth();
          loadMessages();
          startMessagesPolling();
        } else {
          authToken = '';
          window.localStorage.removeItem('vivelaretraite-token');
          renderReservations([]);
          if (typeof updateNavAuth === 'function') updateNavAuth();
        }
      })
      .catch(() => {});
  } else {
    renderReservations([]);
    if (typeof updateNavAuth === 'function') updateNavAuth();
  }

  const themeToggle = document.querySelector('.theme-toggle');
  const themeIcon = document.querySelector('.theme-toggle-icon');
  const themeLabel = document.querySelector('.theme-toggle-label');
  function applyTheme(theme) {
    if (theme === 'dark') {
      document.body.setAttribute('data-theme', 'dark');
      themeIcon.textContent = '‚òÄÔ∏è';
      themeLabel.textContent = 'Clair';
    } else {
      document.body.removeAttribute('data-theme');
      themeIcon.textContent = 'üåô';
      themeLabel.textContent = 'Sombre';
    }
  }
  const storedTheme = window.localStorage.getItem('vivelaretraite-theme');
  applyTheme(storedTheme === 'dark' ? 'dark' : 'light');
  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      const current = document.body.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
      const next = current === 'dark' ? 'light' : 'dark';
      window.localStorage.setItem('vivelaretraite-theme', next);
      applyTheme(next);
    });
  }
</script>
</body>
</html>
